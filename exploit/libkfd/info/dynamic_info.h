/*
 * Copyright (c) 2023 Félix Poulin-Bélanger. All rights reserved.
 */

#ifndef dynamic_info_h
#define dynamic_info_h

struct dynamic_info {
    const char* kern_version;
    bool kread_kqueue_workloop_ctl_supported;
    bool perf_supported;
    // struct proc
    u64 proc__p_list__le_prev;
    u64 proc__p_pid;
    u64 proc__p_fd__fd_ofiles;
    u64 proc__object_size;
    // struct task
    u64 task__map;
    // struct thread
    u64 thread__thread_id;
    // kernelcache static addresses (perf)
    u64 kernelcache__cdevsw;                          // "spec_open type" or "Can't mark ptc as kqueue ok"
    u64 kernelcache__gPhysBase;                       // "%s: illegal PA: 0x%llx; phys base 0x%llx, size 0x%llx"
    u64 kernelcache__gPhysSize;                       // (gPhysBase + 0x8)
    u64 kernelcache__gVirtBase;                       // "%s: illegal PA: 0x%llx; phys base 0x%llx, size 0x%llx"
    u64 kernelcache__perfmon_dev_open;                // "perfmon: attempt to open unsupported source: 0x%x"
    u64 kernelcache__perfmon_devices;                 // "perfmon: %s: devfs_make_node_clone failed"
    u64 kernelcache__ptov_table;                      // "%s: illegal PA: 0x%llx; phys base 0x%llx, size 0x%llx"
    u64 kernelcache__vn_kqfilter;                     // "Invalid knote filter on a vnode!"
};

const struct dynamic_info kern_versions[] = {
    {
        .kern_version = "Darwin Kernel Version 22.6.0: Wed Jun 28 20:52:06 PDT 2023; root:xnu-8796.142.1~1/RELEASE_ARM64_T8015",
        .kread_kqueue_workloop_ctl_supported = false,
        .perf_supported = true,
        .proc__p_list__le_prev = 0x8,
        .proc__p_pid = 0x60,
        .proc__p_fd__fd_ofiles = 0xf8,
        .proc__object_size = 0x730,
        .task__map = 0x28,
        .thread__thread_id = 0,
        .kernelcache__cdevsw = 0xfffffff007859200,
        .kernelcache__gPhysBase = 0xfffffff007158170,
        .kernelcache__gPhysSize = 0xfffffff007158170 + 8,
        .kernelcache__gVirtBase = 0xfffffff007156368,
        .kernelcache__perfmon_devices = 0xfffffff0078993d0,
        .kernelcache__perfmon_dev_open = 0xfffffff007322a8c,
        .kernelcache__ptov_table = 0xfffffff00710b0a8,
        .kernelcache__vn_kqfilter = 0xfffffff00736c5f4,
    },
    {
        .kern_version = "Darwin Kernel Version 22.1.0: Thu Oct  6 19:32:38 PDT 2022; root:xnu-8792.42.7~1/RELEASE_ARM64_T8030",
        .kread_kqueue_workloop_ctl_supported = false,
        .perf_supported = true,
        .proc__p_list__le_prev = 0x8,
        .proc__p_pid = 0x60,
        .proc__p_fd__fd_ofiles = 0xf8,
        .proc__object_size = 0x530,
        .task__map = 0x28,
        .thread__thread_id = 0,
        .kernelcache__cdevsw = 0xfffffff00a285150,
        .kernelcache__gPhysBase = 0xfffffff007843910,
        .kernelcache__gPhysSize = 0xfffffff007843910 + 8,
        .kernelcache__gVirtBase = 0xfffffff007841af8,
        .kernelcache__perfmon_devices = 0xfffffff00a2c02f0,
        .kernelcache__perfmon_dev_open = 0xfffffff007eabfe4,
        .kernelcache__ptov_table = 0xfffffff0077f78a8,
        .kernelcache__vn_kqfilter = 0xfffffff007efe210,
    },
};

#endif /* dynamic_info_h */
